---

title: Breaking with the past (or…Fluent Assertions 2.0 is in beta)
date: '2012-08-26T19:45:00.000+02:00'

tags:
- Fluent Assertions
modified_time: '2012-09-03T18:32:46.297+02:00'
blogger_id: tag:blogger.com,1999:blog-15137028.post-7878603056335979437
blogger_orig_url: http://www.continuousimprover.com/2012/08/breaking-with-past-orfluent-assertions.html
---

After many months of development, in particular during in evenings after work and in the weekends, we’re proud to present the first (and hopefully the only) beta of Fluent Assertions 2.0. Together with my good friend and coworker <a href="http://www.codeplex.com/site/users/view/mopdam">Martin Opdam</a>, and supported by noticeable contributors like <a href="http://novotny.org/blog">Oren Novotny</a> and <a href="http://ianobermiller.com/">Ian Obermiller</a>, we managed to introduce a shipload of new features. <br /><div>&nbsp;</div><img height="195" src="http://images.androidworld.nl/wp-content/uploads/VLC-Beta-NEON-version_featured_logo.png" style="display: block; float: none; margin-left: auto; margin-right: auto;" width="195" /><br /><br />For instance, Oren worked on the foundations for supporting the new Windows 8 Metro-style apps, whereas Ian created the initial Windows Phone 7.5 version. Martin added support for .NET 4.5, added quite a few new variations and overloads to the existing assertions and also fixed a lot of the reported bugs. I myself introduced a completely new extensible API for comparing two objects graphs for equivalence. As the original founder of this project, I also took charge of safeguarding the overall quality and consistency.<br /><br />And now that I mention it, after a week of debugging I almost decided to drop Windows Phone support altogether. I was suffering from two really persistent <span style="font-family: Consolas;">ReflectionTypeLoadException</span>s and <span style="font-family: Consolas;">MissingMethodException</span>s. Since I’ve started developing on the .NET platform in 2001, I’ve run into some pretty weird issues, but this was a whole new league for me (read the <a href="http://stackoverflow.com/questions/12067070/getexportedtypes-on-an-assembly-throws-notsupportedexception/12067971#comment16169864_12067971">StackOverflow</a> discussion to learn a bit more about this issue). Fortunately <a href="http://blog.catenalogic.com/">Geert van Horrik</a> pointed me at a blog post he wrote a while back that explained Windows Phone’s <a href="http://blog.catenalogic.com/post/2011/08/27/Windows-Phone-7-and-MissingMethodException.aspx">lack of support</a> for co- and contravariance. And indeed, that was exactly the problem I was facing all the time. <br /><br />So in addition to support for the aforementioned .NET flavors and support for MBUnit and the Gallio Automation Platform, what else did we add?<br /><br /><strong>What's new for collections</strong>  <br /><ul><li>Added (<span style="font-family: Consolas;">Not</span>)<span style="font-family: Consolas;">BeInAscendingOrder()</span>, (<span style="font-family: Consolas;">Not</span>)<span style="font-family: Consolas;">BeInDescendingOrder</span>(), <span style="font-family: Consolas;">IntersectWith(otherCollection)</span> and <span style="font-family: Consolas;">NotIntersectWith(otherCollection)</span>. <li><span style="font-family: Consolas;">ContainInOrder()</span> got an overload that takes a <span style="font-family: Consolas;">params object[]</span> argument rather than an <span style="font-family: Consolas;">IEnumerable</span> in case you don't care about the reason. <li>Added <span style="font-family: Consolas;">ContainSingle()</span> that asserts there is only a single element in the collection that matches the specified lambda. <li>Added an overload to <span style="font-family: Consolas;">Equal()</span> that takes a lambda that is used for checking the equality of two collections without relying on the type’s Equals() method. Consider for instance two collections that contain some kind of domain entity persisted to a database and then reloaded. Since the actual object instance is different, if you want to make sure a particular property was properly persisted, you usually do something like this:<pre class="csharpcode">persistedCustomers.Select(c =&gt; c.Name).Should().Equal(customers.Select(c =&gt; c.Name);</pre><span style="font-family: Calibri;"></span><div><span style="font-family: Calibri;">With this new overload, you can rewrite it into:</span></div><pre class="csharpcode">persistedCustomers.Should().Equal(customers, c =&gt; c.Name);</pre><li>Fixed a bug that occurred when two collections are compared for equality but the collection contains <span style="font-family: Consolas; font-size: x-small;">null</span>s.</li></li></li></li></li></ul><strong></strong><br /><strong>What's new for strings </strong><br /><ul><li><div>When strings differ in length, it will report the expected and actual lengths as part of the error messages.</div><li><div>An <span style="font-family: Consolas;">ArgumentOutOfRangeException</span> was thrown when asserting that a string started with a specific string and the first string was shorter than the expected string.</div></li></li></ul><strong></strong><br /><strong>What's new for numbers </strong><br /><ul><li>Added support for using <span style="font-family: Consolas;">Be()</span> on nullable numeric types.</li><li>Added <span style="font-family: Consolas;">BeOneOf()</span> to assert that a value matches one of the provided values. </li><li>Added support for (nullable) decimals </li><li><span style="font-family: Consolas;">BePositive()</span> and <span style="font-family: Consolas;">BeNegative()</span> now also work for floats and doubles.</li></ul><strong></strong><br /><strong>What's new for dates and times </strong><br /><ul><li><div>Added <span style="font-family: Consolas;">NotBe()</span>. Also added <span style="font-family: Consolas;">BeOneOf()</span> to verify that the value matches one of the provided values.&nbsp;&nbsp;</div><li><div>Added <span style="font-family: Consolas;">BeCloseTo()</span> to assert that a date/time is within a specified number of milliseconds from another date/time value. This can be particularly useful if your database truncates date/time values. </div><li><div>If a date/time value has non-zero milliseconds then that will be displayed in the error messages .</div></li></li></li></ul><strong></strong><br /><strong>What's new for comparing object graphs </strong><br />I’ll dedicate a <a href="http://www.dennisdoomen.net/2012/09/asserting-object-graph-equivalence.html">separate</a> blog post on the new <span style="font-family: Consolas;">object.ShouldBeEquivalentTo(object)</span> and <span style="font-family: Consolas;">collection.ShouldAllBeEquivalentTo(collection)</span>, but the existing API based on the <span style="font-family: Consolas;">object.ShouldHave()</span> has benefited from the internal redesign as well. <br /><ul><li><div>You can now apply the property equality comparisons to entire collections of objects. It doesn't matter what kind of collection type you use, as long as it contains the same number of objects, and the object’s properties match. </div><li><div>The error message now includes the index of the mismatching object.</div><li><div>An exception was thrown when comparing the properties of an object and one of them causes a cyclic reference. You can now alter that behavior by passing in a value from the <span style="font-family: Consolas;">CyclicReferenceHandling</span> enum into the <span style="font-family: Consolas;">IncludingNestedObjects()</span> method.</div><li><div>Added support for references to an interface rather than concrete types. You can find an example of that at the corresponding <a href="http://fluentassertions.codeplex.com/workitem/11840">feature request</a> page. </div><li><div>Added support for comparing two anonymous types using <span style="font-family: Consolas;">SharedProperties()</span>.</div><li><div>Fixed a bug that caused an exception to be thrown for write-only properties. They are now ignored. </div><li><div>Fixed a stack overflow exception when formatting an object graph that contains a static property with a cyclic reference. </div><li><div>Fixed an exception that was thrown when formatting an object graph and one of the properties throws.</div><li><div>The name of a date/time property was not included in the error message when <span style="font-family: Consolas;">AllProperties()</span> failed on that property</div></li></li></li></li></li></li></li></li></li></ul><br /><strong>What's new for types </strong><br /><ul><li><div>Added the static <span style="font-family: Consolas;">AllTypes</span> class with a static method <span style="font-family: Consolas;">From(Assembly assembly)</span> as a wrapper around the <span style="font-family: Consolas; font-size: x-small;">Types</span> extension method on <span style="font-family: Consolas; font-size: x-small;">Assembly</span>. This allows for a more fluent syntax like </div><div><pre class="csharpcode">AllTypes.From(assembly)<br />  .ThatAreDecoratedWith&lt;SomeAttribute&gt;()<br />  .ThatImplement&lt;ISomeInterface&gt;()<br />  .ThatAreInNamespace(<span class="str">"Internal.Main.Test"</span>);</pre></div></li></ul><ul><li>Added support for asserting that the properties of an attribute have a specific value. For instance:&nbsp;<pre class="csharpcode">typeWithAttribute.Should()<br />  .BeDecoratedWith&lt;DummyClassAttribute&gt;(a =&gt; ((a.Name == <span class="str">"Unexpected"</span>) &amp;&amp; a.IsEnabled));</pre></li></ul><strong>What other improvements&nbsp;did we&nbsp;include&nbsp;</strong><br /><ul><li><div>Fixed an exception when asserting the equality of dictionaries that contain <span style="font-family: Consolas;">null</span>s. </div><li><div>The NuGet package will automatically add references to the <span style="font-family: Consolas;">System.Xml</span> and <span style="font-family: Consolas;">System.Xml.Linq</span> references. </div><li><div>Added a <span style="font-family: Consolas;">ShouldThrow&lt;TException&gt;()</span> method for a <span style="font-family: Consolas;">Func&lt;Task&gt;</span> to support working with async methods like this:<br /><pre class="csharpcode">  Func&lt;Task&gt; slowFunction = async () =&gt; { await slowObject.ThrowAsync&lt;ArgumentException&gt;(); };<br />  slowFunction.ShouldThrow&lt;InvalidOperationException&gt;();&nbsp;</pre></div><li><div>Improved several of the error messages related to assertions on <span style="font-family: Consolas;">XDocument</span> and <span style="font-family: Consolas;">XElement</span>.&nbsp;&nbsp;</div><li><div>All overloads that took the <em>reason</em> and <em>reasonargs</em> parameters have been removed and replaced with optional parameters </div><li><div>Allowed <span style="font-family: Consolas; font-size: x-small;">ShouldRaisePropertyChangeFor(null)</span> to assert that an object implemented <span style="font-family: Consolas; font-size: x-small;">INotifyPropertyChanged</span> raised the changed event for all properties.</div></li></li></li></li></li></li></ul><br /><strong>What’s new for extensibility</strong><br /><ul><li><div>The list of <span style="font-family: Consolas;">IValueFormatter</span> objects on the <span style="font-family: Consolas; font-size: x-small;">Formatter</span> class can be altered to insert a custom formatter. </div><li><div>Introduced a mechanism to override the way Fluent Assertions formats objects in an error message by annotating a static method with the <span style="font-family: Consolas;">[ValueFormatter]</span> attribute. If a class doesn’t override ToString(), the built-in DefaultValueFormatter will render an object graph of that object. But you can now override that using a construct like this:</div><div><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">class</span> CustomFormatter<br />{<br />    [ValueFormatter]<br />    <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">string</span> Foo(SomeClassvalue)<br />    {<br />        <span class="kwrd">return</span> <span class="str">"Property = "</span> + <span class="kwrd">value</span>.Property;<br />    }<br />}</pre></div><li><div>We introduced a mechanism so that the error message of custom assertion extensions can specify the {context} tag that is used to inject the property path in object graph comparisons. For instance, in the date/time assertions, this is used to display <em>date and time. </em>But when this assertion is used as part of a recursive object graph comparison, it will display the property path instead.</div><div><pre class="csharpcode">Execute.Verification<br />    .ForCondition(Subject.Value == expected)<br />    .BecauseOf(reason, reasonArgs)<br />    .FailWith(<span class="str">"Expected {context:date and time} to be {0}{reason}, but found {1}."</span>, expected, subject.Value);</pre></div></li></li></li></ul><ul><li>The NuGet package is now based on NuGet 2.0.</li></ul><br /><strong>Breaking changes</strong><br />Since we decided to bump up the version from 1.7.1 to 2.0 and we’ve already told you that we comply to <a href="http://semver.org/">Semantic Versioning</a>, you can expect some breaking changes in this release. <br /><ul><li><div>In order to ensure that all extension methods are always available through the <span style="font-family: Consolas;">FluentAssertions</span> namespace, we had to get rid of the <span style="font-family: Consolas;">FluentAssertions.Assertions</span> namespace. Just use a global search-replace to remove all those usage statements.&nbsp;&nbsp;</div><li><div>Many of the assertion classes have moved into dedicated namespaces. You might have to fix any code that inherits from those classes. </div><li><div>Remove the obsolete <span style="font-family: Consolas;">Verify()</span> methods from the <span style="font-family: Consolas;">Verification</span> class</div></li></li></li></ul><strong></strong><br /><strong>So what’s next</strong><br />To get started, get the <a href="https://nuget.org/packages/FluentAssertions">NuGet</a> package from inside Visual Studio (just make sure you include pre-release versions), or get the ZIP through the <a href="http://fluentassertions.codeplex.com/releases/view/82423">CodePlex</a> download page. If you run into issues, I would prefer that you ping me directly on <a href="http://twitter.com/ddoomen">Twitter</a> before you file an issue on CodePlex’s <a href="http://fluentassertions.codeplex.com/workitem/list/advanced">Issue Tracker</a>. By the way, we use the <a href="http://twitter.com/#!/search/realtime/%23fluentassertions">#fluentassertions</a> tag on Twitter. For questions, remarks or suggestions, you can use the <a href="http://fluentassertions.codeplex.com/discussions">Discussions</a> page, <a href="http://stackoverflow.com/questions/tagged/fluent-assertions">StackOverflow</a>, or you can contact me directly by <a href="mailto:dennis.doomen@avivasolutions.nl">email</a> or <a href="http://twitter.com/ddoomen">Twitter</a>.<br /><strong></strong><br /><strong>Off topic</strong>: Although we’re still on CodePlex, the source code  of Fluent Assertions is now stored in a <a href="http://git-scm.com/documentation"><span style="color: #992211;">Git</span></a> repository. That&nbsp;should make it  a whole lot easier for contributors to fork the code,&nbsp;write&nbsp;a nice  improvement,&nbsp;and send us a pull request. 